name: T68_PageRank
version: "1.0"
description: "Calculates PageRank scores for entities in the graph"

input_contract:
  type: object
  properties:
    calculation_scope:
      type: string
      enum: ["full_graph", "subgraph", "entity_type"]
      default: "full_graph"
      description: "Scope of PageRank calculation"
    entity_type_filter:
      type: string
      description: "Optional entity type to filter calculation"
    damping_factor:
      type: number
      minimum: 0
      maximum: 1
      default: 0.85
      description: "PageRank damping factor"
    max_iterations:
      type: integer
      minimum: 1
      maximum: 1000
      default: 20
      description: "Maximum iterations for convergence"
    tolerance:
      type: number
      minimum: 0
      maximum: 0.1
      default: 0.0001
      description: "Convergence tolerance"
    neo4j_config:
      type: object
      properties:
        uri:
          type: string
          pattern: "^bolt://"
        database:
          type: string
          default: "neo4j"
      required:
        - uri
  required: []

output_contract:
  type: object
  properties:
    pagerank_scores:
      type: array
      items:
        type: object
        properties:
          entity_id:
            type: string
          entity_name:
            type: string
          entity_type:
            type: string
          pagerank_score:
            type: number
            minimum: 0
            maximum: 1
          rank:
            type: integer
            minimum: 1
            description: "Rank position (1 = highest score)"
          inbound_edges:
            type: integer
            minimum: 0
          outbound_edges:
            type: integer
            minimum: 0
        required:
          - entity_id
          - entity_name
          - entity_type
          - pagerank_score
          - rank
    summary:
      type: object
      properties:
        total_entities:
          type: integer
          minimum: 0
        calculation_scope:
          type: string
        iterations_performed:
          type: integer
          minimum: 1
        converged:
          type: boolean
        convergence_delta:
          type: number
          minimum: 0
        top_entity:
          type: object
          properties:
            entity_id:
              type: string
            entity_name:
              type: string
            score:
              type: number
        score_distribution:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
            mean:
              type: number
            median:
              type: number
            std_dev:
              type: number
      required:
        - total_entities
        - calculation_scope
        - iterations_performed
        - converged
    execution_metadata:
      type: object
      properties:
        tool_name:
          type: string
          const: "T68_PageRank"
        execution_time:
          type: number
          minimum: 0
        neo4j_connected:
          type: boolean
        algorithm_used:
          type: string
          enum: ["networkx", "neo4j_gds", "scipy_sparse"]
      required:
        - tool_name
        - execution_time
        - neo4j_connected
        - algorithm_used
  required:
    - pagerank_scores
    - summary
    - execution_metadata