name: T34_EdgeBuilder
version: "1.0"
description: "Builds relationship edges between entities in Neo4j graph"

input_contract:
  type: object
  properties:
    relationships:
      type: array
      minItems: 1
      items:
        type: object
        properties:
          source_entity_id:
            type: string
          target_entity_id:
            type: string
          relationship_type:
            type: string
            minLength: 1
          confidence:
            type: number
            minimum: 0
            maximum: 1
          properties:
            type: object
            description: "Ontology-validated relationship properties"
          modifiers:
            type: object
            description: "Ontology-validated relationship modifiers"
          source_chunk_id:
            type: string
        required:
          - source_entity_id
          - target_entity_id
          - relationship_type
          - confidence
    entity_mappings:
      type: object
      description: "Mapping of entity IDs to Neo4j node IDs"
      additionalProperties:
        type: integer
    neo4j_config:
      type: object
      properties:
        uri:
          type: string
          pattern: "^bolt://"
        database:
          type: string
          default: "neo4j"
      required:
        - uri
  required:
    - relationships
    - entity_mappings

output_contract:
  type: object
  properties:
    created_edges:
      type: array
      items:
        type: object
        properties:
          edge_id:
            type: string
            pattern: "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
          source_entity_id:
            type: string
          target_entity_id:
            type: string
          relationship_type:
            type: string
          neo4j_id:
            type: integer
            description: "Neo4j internal relationship ID"
          merged:
            type: boolean
            description: "Whether edge was merged with existing"
          ontology_validated:
            type: boolean
            description: "Whether relationship passed ontology validation"
          validation_errors:
            type: array
            items:
              type: string
        required:
          - edge_id
          - source_entity_id
          - target_entity_id
          - relationship_type
          - neo4j_id
          - merged
    summary:
      type: object
      properties:
        total_relationships:
          type: integer
          minimum: 0
        created_count:
          type: integer
          minimum: 0
        merged_count:
          type: integer
          minimum: 0
        failed_count:
          type: integer
          minimum: 0
        ontology_validated_count:
          type: integer
          minimum: 0
        invalid_entities_count:
          type: integer
          minimum: 0
      required:
        - total_relationships
        - created_count
        - merged_count
        - failed_count
    execution_metadata:
      type: object
      properties:
        tool_name:
          type: string
          const: "T34_EdgeBuilder"
        execution_time:
          type: number
          minimum: 0
        neo4j_connected:
          type: boolean
      required:
        - tool_name
        - execution_time
        - neo4j_connected
  required:
    - created_edges
    - summary
    - execution_metadata

ontology_integration:
  validate_relationship_types: true
  validate_domain_range: true
  validate_properties: true
  allowed_relationship_concepts:
    - "BelongsTo"
    - "Influences"
    - "Regulates"
    - "Communicates"
    - "Participates"
    - "FollowsNorm"
    - "HasRole"
    - "Controls"
    - "Provides"
    - "ConflictsWith"
    - "SupportedBy"
    - "FundedBy"
    - "CompetesWith"
    - "CollaboratesWith"
    - "HasPower"
    - "HasResource"
    - "Sanctions"
    - "Monitors"
    - "Legitimizes"
    - "DependsOn"
    - "Constrains"
    - "HasCapability"
    - "Observes"